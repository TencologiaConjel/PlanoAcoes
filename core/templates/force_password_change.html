{% extends "base.html" %}
{% load static %}
{% block title %}Redefinir senha{% endblock %}

{% block content %}
<div class="container py-4" style="max-width: 560px;">
  <div class="card shadow-sm border-0">
    <div class="card-body p-4">

      <div class="text-center mb-3">
        <i class="bi bi-shield-lock" style="font-size: 2.2rem; color:#1f4aa8;"></i>
        <h3 class="mt-2 mb-0">Redefinir senha</h3>
        <p class="text-muted mb-0">Por segurança, você precisa definir uma nova senha antes de continuar.</p>
      </div>

      {# erros gerais do form #}
      {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
          {% for err in form.non_field_errors %}{{ err }}<br>{% endfor %}
        </div>
      {% endif %}

      <form method="post" novalidate>
        {% csrf_token %}

        <div class="mb-3">
          <label class="form-label" for="{{ form.new_password1.id_for_label }}">
            Nova senha
          </label>
          <div class="input-group">
            <input
              type="password"
              name="{{ form.new_password1.html_name }}"
              id="{{ form.new_password1.id_for_label }}"
              class="form-control {% if form.new_password1.errors %}is-invalid{% endif %}"
              autocomplete="new-password"
              required
            >
            <button type="button" class="btn btn-outline-secondary" tabindex="-1"
                    onclick="toggleVis('id_new_password1', this)">
              <i class="bi bi-eye"></i>
            </button>
            {% for err in form.new_password1.errors %}
              <div class="invalid-feedback d-block">{{ err }}</div>
            {% endfor %}
          </div>
          {% if form.new_password1.help_text %}
            <div class="form-text">{{ form.new_password1.help_text|safe }}</div>
          {% endif %}
        </div>

        <div class="mb-3">
          <label class="form-label" for="{{ form.new_password2.id_for_label }}">
            Confirmar nova senha
          </label>
          <div class="input-group">
            <input
              type="password"
              name="{{ form.new_password2.html_name }}"
              id="{{ form.new_password2.id_for_label }}"
              class="form-control {% if form.new_password2.errors %}is-invalid{% endif %}"
              autocomplete="new-password"
              required
            >
            <button type="button" class="btn btn-outline-secondary" tabindex="-1"
                    onclick="toggleVis('id_new_password2', this)">
              <i class="bi bi-eye"></i>
            </button>
            {% for err in form.new_password2.errors %}
              <div class="invalid-feedback d-block">{{ err }}</div>
            {% endfor %}
          </div>
        </div>

        <button class="btn btn-primary w-100" type="submit">
          <i class="bi bi-check2-circle me-1"></i> Salvar nova senha
        </button>

      </form>

      <hr class="my-4">
      <div class="small text-muted">
        <strong>Dicas de senha segura:</strong>
        <ul class="mb-0">
          <li>Use pelo menos 8 caracteres (letras maiúsculas/minúsculas, números e símbolos).</li>
          <li>Evite informações óbvias (nome, data de nascimento, “123456”).</li>
          <li>Não reutilize a senha de outros serviços.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  function toggleVis(id, btn){
    const input = document.getElementById(id);
    const icon  = btn.querySelector('i');
    if(!input) return;
    const isPwd = input.type === 'password';
    input.type = isPwd ? 'text' : 'password';
    icon.classList.toggle('bi-eye');
    icon.classList.toggle('bi-eye-slash');
  }
</script>
{% endblock %}
